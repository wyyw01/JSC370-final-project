---
title: "JSC370 Final Project: analysis on covid19 data. (Currently it is only hw5 added on top of lab12)"
author: "Wei Yu"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

<br>

This is my JSC370 Final Project website. I will showcase a few interactive visuals here.

<br>

```{r setup, message=FALSE, echo=FALSE, warning=FALSE}

library(data.table)
library(tidyverse)
library(dplyr)
library(plotly)
library(DT)
library(knitr)

# Initialize code chunk options
opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = TRUE,
  cache = FALSE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618,
  out.width = "700px",
  class.source = "code-r")
```

```{css, echo = FALSE}
.code-r { /* Code block */
  font-size: 15px;
}

.code-r-small { /* Code block */
  font-size: 10px;
}
```

<br>

## First step

First I will source any necessary code, e.g. `process_covid_data.R`:

```{r load-data}
source("process_COVID_data.R")
```

<br>

## Second step

Then I will add some code to create the **plotly** figures

Note: You need to name each code chunk, like this one: `plot1`

```{r plot1, class.source="code-r-small"}

p1_scatter <- cv_states_today %>% 
  plot_ly(x = ~pop_density, y = ~deathsper100k,
          type = 'scatter', mode = 'markers', color = ~state,
          size = ~population, sizes = c(5, 70), marker = list(sizemode='diameter', opacity=0.5),
          hoverinfo = 'text',
          text = ~paste( paste(state, ":", sep=""), paste(" Cases per 100k: ", per100k, sep="") , paste(" Deaths per 100k: ",
                        deathsper100k, sep=""), sep = "<br>")) %>%
  layout(title = "Population-normalized COVID-19 deaths vs. population density",
                  yaxis = list(title = "Deaths per 100k"), xaxis = list(title = "Population Density"),
         hovermode = "compare")

# filter out "District of Columbia"
cv_states_today_scatter <- cv_states_today %>% filter(state!="District of Columbia")

p2_scatter <- cv_states_today_scatter %>% 
  plot_ly(x = ~pop_density, y = ~deathsper100k,
          type = 'scatter', mode = 'markers', color = ~state,
          size = ~population, sizes = c(5, 70), marker = list(sizemode='diameter', opacity=0.5),
          hoverinfo = 'text',
          text = ~paste( paste(state, ":", sep=""), paste(" Cases per 100k: ", per100k, sep="") , paste(" Deaths per 100k: ",
                        deathsper100k, sep=""), sep = "<br>")) %>%
  layout(title = "Population-normalized COVID-19 deaths vs. population density",
                  yaxis = list(title = "Deaths per 100k"), xaxis = list(title = "Population Density"),
         hovermode = "compare")
```

<br>

## Third step {.tabset}

Create tabs to display each figure

### Scatterplot: with DC

```{r p1}
p1_scatter
```

### Scatterplot: without DC

```{r p2}
p2_scatter
```



### hw5: Using my midterm/final project data, create 3 different interactive visualizations using the tools learned in week 11 class/lab.
```{r}
hosp_icu <- read.csv('hosp_icu_c19_breakdown.csv')
deaths_data <- read.csv('deaths_fatality_type.csv')
```

```{r}
# hosp_icu$date <- as.Date(hosp_icu$date, format = "%Y/%m/%d")
# deaths_data$date <- as.Date(deaths_data$date, format = "%Y/%m/%d")
hosp_death <- merge(hosp_icu, deaths_data, by = 'date')
# hosp_death
```

```{r}
hosp_death$total_death_level <- ifelse(hosp_death$deaths_total <= 10, 1,
          ifelse(hosp_death$deaths_total <= 20, 2,
          ifelse(hosp_death$deaths_total <= 30, 3,
          ifelse(hosp_death$deaths_total <= 40, 4, 
          ifelse(hosp_death$deaths_total <= 50, 5, 6)))))


```

```{r}
outbreak <- read.csv('activeltcoutbreak.csv')
```


```{r}
# write.csv(hosp_death, "hosp_death.csv", row.names = TRUE)

```


```{r}
library(plotly)
plot_ly(
  hosp_death,
  x = ~ hosp_for_covid,
  y = ~ icu_for_covid,
  color = ~ total_death_level,
  size = ~ death_covid,
  type = "scatter",
  sizes = c(5, 1000),
  marker = list(sizemode = "area", opacity = .8)
)
```


```{r}
outbreak <- read.csv('activeltcoutbreak.csv')
```

```{r}
outbreak$hcw_level <- ifelse(outbreak$Total_LTC_HCW_Cases >= 50, 6,
          ifelse(outbreak$Total_LTC_HCW_Cases >= 40, 5,
          ifelse(outbreak$Total_LTC_HCW_Cases >= 30, 4,
          ifelse(outbreak$Total_LTC_HCW_Cases >= 20, 3, 
          ifelse(outbreak$Total_LTC_HCW_Cases >= 10, 2, 1)))))
```

```{r}
# outbreak
```

    trans = "log", 

```{r}
plt_smooth <- ggplot(
  outbreak,
  aes(x = Beds, y = Total_LTC_Resident_Cases)
) +
  theme_minimal() +
  geom_smooth() +
  geom_point(aes(colour = City, size = hcw_level)) +
  scale_x_continuous(
    breaks = c(1, 10, 100, 1000, 10000),
    labels = c(1, 10, 100, 1000, 10000)
  )
ggplotly(plt_smooth)
```


```{r}
plot_ly(
  outbreak,
  x = ~ Report_Data_Extracted,
  y = ~ Beds,
  color = ~ City,
  mode = "lines"
)
```











```

## {-}

<br>

Done!

<br>
<br>
